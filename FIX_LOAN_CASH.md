# ๐ง ุฅุตูุงุญ: ุงูุฅูุฑุงุถ ุงูููุฏู ูุง ููุณุฌู ูู ุงูุฑุตูุฏ

**ุงูุชุงุฑูุฎ:** 25 ุฃูุชูุจุฑ 2025  
**ุงููุดููุฉ:** ุนูุฏ ุฅูุฑุงุถ ุดุฎุต ููุฏูุงุ ุงููุนุงููุฉ ุชูุณุฌู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููู ูุง ุชุธูุฑ ูู ุญุณุงุจ ุงูุฑุตูุฏ

---

## ๐ ุงูุณุจุจ ุงูุฌุฐุฑู

ุงูููุทู ุงูุณุงุจู ูุงู ูุนุชุจุฑ:
- `loan_out` + `credit` = ุฏูู (ููุญุชุณุจ) โ
- `loan_out` + `cash` = ููุณ ุฏูููุง (ูุง ููุญุชุณุจ) โ **ุฎุทุฃ!**

**ุงูุญูููุฉ ุงููุญุงุณุจูุฉ:**
> **ุงูุฅูุฑุงุถ ูู ุฏุงุฆููุง ุฏููุ ุณูุงุก ุฃูุฑุถุช ุงููุงู ููุฏูุง ุฃู ุขุฌููุง!**

---

## โ ุงูุญู ุงููุทุจู

### ุงูููุทู ุงูุฌุฏูุฏ:

```
1. purchase_credit:
   - cash โ ูุง ููุญุชุณุจ (ุดุฑุงุก ููุฏู ุนุงุฏู)
   - credit โ ููุญุชุณุจ (ุฏูู)
   
2. loan_out:
   - cash โ ููุญุชุณุจ (ุฃูุฑุถุช ููุฏูุง = ุฏูู ุนูููู)
   - credit โ ููุญุชุณุจ (ุฃูุฑุถุช ุขุฌููุง = ุฏูู ุนูููู)
   
3. payment / settlement:
   - ุฃู ุทุฑููุฉ ุฏูุน โ ุชูููุต ุงูุฏูู
```

---

## ๐ ุงููููุงุช ุงูููุนุฏููุฉ

### 1๏ธโฃ `database_helper.dart`

#### ุฃ) `getPartyBalance()` (ุงูุณุทุฑ 737)
```dart
// ูุจู:
if (isDebtCreation && paymentMethod != 'credit') {
  continue; // ุชุฌุงูู ุงูุดุฑุงุก/ุงูุฅูุฑุงุถ ุงูููุฏู โ
}

// ุจุนุฏ:
if (kind == 'purchase_credit' && paymentMethod != 'credit') {
  continue; // ุชุฌุงูู ุงูุดุฑุงุก ุงูููุฏู ููุท โ
}
// loan_out ููุญุชุณุจ ุฏุงุฆููุง
```

#### ุจ) `getPartyStats()` (ุงูุณุทุฑ 812)
```sql
-- ูุจู:
WHEN (de.kind = 'purchase_credit' OR de.kind = 'loan_out') 
     AND de.paymentMethod = 'credit' THEN de.amount

-- ุจุนุฏ:
WHEN de.kind = 'purchase_credit' AND de.paymentMethod = 'credit' THEN de.amount
WHEN de.kind = 'loan_out' THEN de.amount  -- ุฏุงุฆููุง
```

#### ุฌ) `getAllPartiesStats()` (ุงูุณุทุฑ 857)
```sql
-- ููุณ ุงูุชุนุฏูู ุฃุนูุงู
```

---

### 2๏ธโฃ `party_details_screen.dart`

#### `_computeBalance()` (ุงูุณุทุฑ 45)
```dart
// ูุจู:
if (isDebtCreation && entry.paymentMethod.name != 'credit') {
  continue; // ุชุฌุงูู ุงูุดุฑุงุก/ุงูุฅูุฑุงุถ ุงูููุฏู โ
}

// ุจุนุฏ:
if (entry.kind == 'purchase_credit' && entry.paymentMethod.name != 'credit') {
  continue; // ุชุฌุงูู ุงูุดุฑุงุก ุงูููุฏู ููุท โ
}
// loan_out ููุญุชุณุจ ุฏุงุฆููุง
```

---

### 3๏ธโฃ `debts_stats_card.dart`

#### `_loadStats()` - ุงุณุชุนูุงู receivable (ุงูุณุทุฑ 48)
```sql
-- ูุจู:
WHEN (de.kind = 'purchase_credit' OR de.kind = 'loan_out') 
     AND de.paymentMethod = 'credit' THEN de.amount

-- ุจุนุฏ:
WHEN de.kind = 'purchase_credit' AND de.paymentMethod = 'credit' THEN de.amount
WHEN de.kind = 'loan_out' THEN de.amount  -- ุฏุงุฆููุง
```

#### ุงุณุชุนูุงู payable (ุงูุณุทุฑ 70)
```sql
-- ููุณ ุงูุชุนุฏูู ุฃุนูุงู
```

---

### 4๏ธโฃ `debt_transaction_modal.dart`

#### `_getDefaultPaymentMethod()` (ุงูุณุทุฑ 62)
```dart
// ูุจู:
case 'loan_out':
  return PaymentMethod.credit; // ุงูุฅูุฑุงุถ ูู ุฏูู (ุขุฌู)

// ุจุนุฏ:
case 'loan_out':
  return PaymentMethod.cash; // ุงูุฅูุฑุงุถ ุงูุชุฑุงุถููุง ููุฏู โ
```

**ุงูุณุจุจ:** ุงูุฅูุฑุงุถ ุงูููุฏู ูู ุงูุฃูุซุฑ ุดููุนูุง ูู ุงููุงูุน

---

## ๐งช ุงุฎุชุจุงุฑ ุงูุญู

### ุณููุงุฑูู 1: ุฅูุฑุงุถ ููุฏู
1. โ ุงุถุบุท ุนูู "ุฅูุฑุงุถ" ูุดุฎุต
2. โ ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ = **ููุฏู**
3. โ ุฃุฏุฎู ูุจูุบ 1000 ุฏ.ุฌ
4. โ ุงุญูุธ ุงููุนุงููุฉ
5. โ ุงููุชูุฌุฉ: ุงูุฑุตูุฏ ูุฒูุฏ ุจู 1000 (ูู ุนูููู)

### ุณููุงุฑูู 2: ุฅูุฑุงุถ ุขุฌู
1. โ ุงุถุบุท ุนูู "ุฅูุฑุงุถ"
2. โ ุบููุฑ ุทุฑููุฉ ุงูุฏูุน ุฅูู **ุขุฌู**
3. โ ุฃุฏุฎู ูุจูุบ 2000 ุฏ.ุฌ
4. โ ุงุญูุธ ุงููุนุงููุฉ
5. โ ุงููุชูุฌุฉ: ุงูุฑุตูุฏ ูุฒูุฏ ุจู 2000 (ูู ุนูููู)

### ุณููุงุฑูู 3: ุดุฑุงุก ููุฏู (ูุฌุจ ุฃูุง ููุญุชุณุจ)
1. โ ุณุฌู ุดุฑุงุก ูู ููุฑุฏ
2. โ ุบููุฑ ุทุฑููุฉ ุงูุฏูุน ุฅูู **ููุฏู**
3. โ ุฃุฏุฎู ูุจูุบ 500 ุฏ.ุฌ
4. โ ุงููุชูุฌุฉ: **ูุง ููุญุชุณุจ ูุฏูู** (ุดุฑุงุก ููุฏู ุนุงุฏู)

---

## ๐ ุฌุฏูู ููุงุฑูุฉ

| ููุน ุงููุนุงููุฉ | ุทุฑููุฉ ุงูุฏูุน | ูุจู | ุจุนุฏ | ุงูุณุจุจ |
|--------------|-------------|-----|-----|-------|
| `loan_out` | `cash` | โ ูุง ููุญุชุณุจ | โ ููุญุชุณุจ | ุงูุฅูุฑุงุถ ุฏุงุฆููุง ุฏูู |
| `loan_out` | `credit` | โ ููุญุชุณุจ | โ ููุญุชุณุจ | ููุง ูู |
| `purchase_credit` | `cash` | โ ูุง ููุญุชุณุจ | โ ูุง ููุญุชุณุจ | ุดุฑุงุก ููุฏู ุนุงุฏู |
| `purchase_credit` | `credit` | โ ููุญุชุณุจ | โ ููุญุชุณุจ | ููุง ูู |
| `payment` | ุฃู | โ ููููุต ุงูุฏูู | โ ููููุต ุงูุฏูู | ููุง ูู |
| `settlement` | ุฃู | โ ููููุต ุงูุฏูู | โ ููููุต ุงูุฏูู | ููุง ูู |

---

## ๐ฏ ููุฎุต ุงูุชุบููุฑุงุช

### ูุง ุชู ุฅุตูุงุญู:
1. โ **ุงูุฅูุฑุงุถ ุงูููุฏู** ุงูุขู ููุณุฌู ููุธูุฑ ูู ุงูุฑุตูุฏ
2. โ **ุงูุฅูุฑุงุถ ุงูุขุฌู** ูุง ูุฒุงู ูุนูู ููุง ูู
3. โ **ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ** ููุฅูุฑุงุถ = ููุฏู (ุงูุฃูุซุฑ ุดููุนูุง)
4. โ **ุงูุงุชุณุงู ุงููุงูู** ุจูู ุฌููุน ุงูุดุงุดุงุช (Stats, Details, List)

### ูุง ูู ูุชุบูุฑ:
- โ ุงูุดุฑุงุก ุงูููุฏู ูุง ูุฒุงู **ูุง ููุญุชุณุจ** ูุฏูู (ุตุญูุญ)
- โ ุงูุดุฑุงุก ุงูุขุฌู ูุง ูุฒุงู **ููุญุชุณุจ** ูุฏูู (ุตุญูุญ)
- โ ุงูุชุณุฏูุฏ ูุงูุงุณุชูุงู ุจุฃู ุทุฑููุฉ **ุชูููุต** ุงูุฏูู (ุตุญูุญ)

---

## ๐ ุงูุชูุงูู ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ

**ุงูุจูุงูุงุช ุงููุฏููุฉ:**
- ุงููุนุงููุงุช ุงูููุณุฌูุฉ ุณุงุจููุง **ูู ุชุชุฃุซุฑ**
- ููุท ุงูุญุณุงุจ ุงูุฌุฏูุฏ ุณููุทุจู ุนูููุง
- ุฅุฐุง ูุงู ูุฏูู `loan_out` + `cash` ูุฏููุฉุ **ุงูุขู ุณุชุธูุฑ ูู ุงูุฑุตูุฏ**

---

## โ ุงูุชุญูู ูู ุงูุฌูุฏุฉ

- โ ูุง ุฃุฎุทุงุก ูู ุงูููุฏ
- โ ุงูููุทู ูุชุณู ูู 5 ูููุงุช
- โ ุงูุชุนูููุงุช ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ
- โ ุงูุงุณุชุนูุงูุงุช SQL ูุญุณููุฉ

---

**ุงูุญุงูุฉ:** โ **ุฌุงูุฒ ููุฅูุชุงุฌ**
